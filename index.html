<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">

    <title></title>
    <meta name="description" content="">
    <meta name="author" content="Kevin Albertson">

    <style type="text/css">
    </style>

    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>

<body>
    Open up the console.
    <script>
        var arr = [], curByte = 0, bitOfByte = 0;
        // This function will push the last 7 bits of the given byte onto the current array,
        // which contains the numeric values of all bytes.
        function push7(byte) {
            byte = byte << 1;
            console.log('Pushing', byte, byte.toString(2));
            // Align this byte to offset for current byte.
            curByte = curByte | (byte >>> bitOfByte);
            bitOfByte += 7;
            if (bitOfByte >= 8) {
                arr.push(curByte);
                bitOfByte %= 8;
                // Now, take the remainder, left shift by what has been taken.
                curByte = (byte << (7 - bitOfByte)) & 0xFF;
            }
        }

        function decode(base123String) {
            //var unicode = "AÄ¢";
            //var arr = new TextEncoder().encode(base123String);
            var arr = new Uint8Array([0b01000001, 0b11010111, 0b10101010]);
            var specials = []; // Array mapping three special bits to special characters.
            // Now arr is an array of numbers representing raw binary of characters.
            for (var i = 0; i < arr.length; i++) {
                if (arr[i] >>> 7 == 0) {
                    // Regular ascii.
                    console.log('Adding', arr[i], arr[i].toString(2));
                    // push7(byte)
                } else {
                    // 2 byte character.
                    console.log('Two byte code', arr[i].toString(2));
                    // Since we're using Uint8Arrays, left shifting should cut off.
                    var specialIndex = (arr[i] >> 5) & 0b111;
                    console.log('Special index', specialIndex, specialIndex.toString(2));
                    var b1 = (arr[i] & 0b1) << 6;
                    var b2 = arr[i+1] & 0b00111111;
                    console.log(b1.toString(2), b2.toString(2));
                    var remainder = ((arr[i] & 0b1) << 6) | (arr[i+1] & 0b00111111);
                    console.log('Remainder', remainder, remainder.toString(2));
                    i++;
                }
            }
        }

        function printValues(arr) {
            var sArr = [];
            arr.forEach((val) => {
                var bitString = val.toString(2);
                var s = "00000000".substring(0, 8 - bitString.length) + bitString;
                console.log(s);
                sArr.push(s);
            });
            console.log('Concatenated ', sArr.join('-'));
        }

    </script>
</body>
</html>